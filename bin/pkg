#!/usr/bin/env bash
set -e

PKG_SERVER="https://Mauricio-100.github.io/gopu-pkg/"
PACKAGES_JSON="${PKG_SERVER}packages.json"

ACTION=$1
PACKAGE=$2

if [ "$ACTION" != "install" ]; then
  echo "Usage: pkg install <package>"
  exit 1
fi

TMP=$(mktemp)
curl -sL "$PACKAGES_JSON" -o "$TMP"

URL=$(jq -r ".\"$PACKAGE\"" "$TMP")

if [ "$URL" == "null" ]; then
  echo "‚ùå Paquet '$PACKAGE' introuvable"
  exit 1
fi

mkdir -p $HOME/bin
DEST=$HOME/bin/$PACKAGE

echo "üì¶ Installation de $PACKAGE depuis $URL"
curl -L "$URL" -o "$DEST"
chmod +x "$DEST" || true

echo "‚úÖ $PACKAGE install√© dans $HOME/bin/"
