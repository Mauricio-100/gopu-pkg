#!/usr/bin/env bash
set -e

# D√©finir ton registre
PKG_SERVER="https://Mauricio-100.github.io/gopu-pkg/"
PACKAGES_JSON="${PKG_SERVER}packages.json"

# V√©rifier argument
if [ $# -lt 1 ]; then
  echo "Usage: pkg install <package>"
  exit 1
fi

ACTION=$1
PACKAGE=$2

if [ "$ACTION" != "install" ]; then
  echo "Seule la commande 'install' est support√©e"
  exit 1
fi

# T√©l√©charger packages.json
TMP=$(mktemp)
curl -sL "$PACKAGES_JSON" -o "$TMP"

# Extraire l'URL du paquet
URL=$(jq -r ".\"$PACKAGE\"" "$TMP")

if [ "$URL" == "null" ]; then
  echo "‚ùå Paquet '$PACKAGE' introuvable dans le registre"
  exit 1
fi

# Installer le paquet
DEST=$HOME/Documents/bin/$PACKAGE
echo "üì¶ Installation de $PACKAGE depuis $URL"
curl -L "$URL" -o "$DEST"
chmod +x "$DEST" || true

echo "‚úÖ $PACKAGE install√© dans ~/Documents/bin/"
